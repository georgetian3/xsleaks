\subsection{XS-Search}\label{sec:search}

XS-Search 是攻击基于查询的搜索系统的一个重要技巧。此技巧通常需要做多个查询，蛮力获取关于查询对象的信息。以下由案例 \cite{xssearch} 介绍 XS-Search 的运行方式。

Monorail 是 Chromium 以及其他相关项目使用的错误追踪系统。由于查询结果可以以 CSV 格式下载，并且没有针对 CSRF 的保护措施，所以攻击者可以跨源地下载（但不能读取）包含有关漏洞的信息的 CSV 文件。若攻击者将具有浏览未公开的漏洞的人员访问含有 \code{Restrict-View-SecurityTeam} 标签的 URL，则包含关于此类漏洞的信息将会被下载。

此外也存在膨胀 CSV 文件大小的方法。CSV 中的每一列可以在请求中定义，比如 \code{https://bugs.chromium.org/p/chromium/issues/csv?can=1&q=id:51337&colspec=ID+Summary+Summary+Summary} 会将一个编号列以及三个相同的“概要”列存放在 CSV 中，而每一行是符合搜索参数的漏洞。如果再插入更多概要列，因漏洞的概要在文件里多次重复，则含有漏洞和不含漏洞的 CSV 文件大小会有明显的差距。

判断文件的大小就需要使用与之前讨论到类似的漏洞。作者使用了 Cache API，因为只需要向服务器发出一个请求，并可以快速、重复地测量 CSV 文件存入缓存所需要的时间，从而去除了网络的抖动对时间测量带来的变动。虽然这个技巧无法测出文件的绝对大小，但与以知不含有漏洞的文件缓存所需要的时间做比较，就可以判定出任何文件是否含有漏洞。

最后需要选择合适的搜索参数。Monorail 不接受搜索单个字母，但可以搜索单词。作者也发现许多旧的漏洞报告中有存在问题的文件的路径以及行数。Chromium 的源代码库是公开的，因此完整的攻击过程如下：

\begin{enumerate}
    \item 使用 \code{OR} 运算查询根目录下的一半的文件夹。
    \item 若查询成功（即 CSV 文件大小较大），则对相同一半的文件夹重复第一步，直到寻找到了包含漏洞的文件夹。类似地，如果查询失败，则查询另一半文件夹。
    \item 找到了包含漏洞的文件夹后，将这个文件夹设为根目录，重复第一步，直到找到含有漏洞的文件。
\end{enumerate}

